FROM node:18-alpine

# Create app directory
WORKDIR /usr/src/app

# Set production environment
ENV NODE_ENV=production

# Copy package manifest(s) and install only production deps to leverage cache
COPY package*.json ./
RUN npm ci --only=production

# Copy application source
COPY . .

# Create a non-root user and give ownership
RUN addgroup -S app && adduser -S app -G app && chown -R app:app /usr/src/app

USER app

# Expose the port the app listens on
EXPOSE 3003

# Start the application
CMD ["node", "app.js"]
